layui.define(["laytpl","form"],(function(e){"use strict";var a=layui.$,t=layui.laytpl,i=layui.form,n="transfer",l={config:{},index:layui[n]?layui[n].index+1e4:0,set:function(e){var t=this;return t.config=a.extend({},t.config,e),t},on:function(e,a){return layui.onevent.call(this,n,e,a)}},r=function(){var e=this,a=e.config,t=a.id||e.index;return r.that[t]=e,r.config[t]=a,{config:a,reload:function(a){e.reload.call(e,a)},getData:function(){return e.getData.call(e)}}},c="layui-hide",o="layui-btn-disabled",d="layui-none",s="layui-transfer-box",u="layui-transfer-header",h="layui-transfer-search",f="layui-transfer-data",y=function(e){return['<div class="layui-transfer-box" data-index="'+(e=e||{}).index+'">','<div class="layui-transfer-header">','<input type="checkbox" name="'+e.checkAllName+'" lay-filter="layTransferCheckbox" lay-type="all" lay-skin="primary" title="{{ d.data.title['+e.index+"] || 'list"+(e.index+1)+"' }}\">","</div>","{{# if(d.data.showSearch){ }}",'<div class="layui-transfer-search">','<i class="layui-icon layui-icon-search"></i>','<input type="input" class="layui-input" placeholder="关键词搜索">',"</div>","{{# } }}",'<ul class="layui-transfer-data"></ul>',"</div>"].join("")},p=['<div class="layui-transfer layui-form layui-border-box" lay-filter="LAY-transfer-{{ d.index }}">',y({index:0,checkAllName:"layTransferLeftCheckAll"}),'<div class="layui-transfer-active">','<button type="button" class="layui-btn layui-btn-sm layui-btn-primary layui-btn-disabled" data-index="0">','<i class="layui-icon layui-icon-next"></i>',"</button>",'<button type="button" class="layui-btn layui-btn-sm layui-btn-primary layui-btn-disabled" data-index="1">','<i class="layui-icon layui-icon-prev"></i>',"</button>","</div>",y({index:1,checkAllName:"layTransferRightCheckAll"}),"</div>"].join(""),v=function(e){var t=this;t.index=++l.index,t.config=a.extend({},t.config,l.config,e),t.render()};v.prototype.config={title:["列表一","列表二"],width:200,height:360,data:[],value:[],showSearch:!1,id:"",text:{none:"无数据",searchNone:"无匹配数据"}},v.prototype.reload=function(e){var t=this;layui.each(e,(function(e,a){a.constructor===Array&&delete t.config[e]})),t.config=a.extend(!0,{},t.config,e),t.render()},v.prototype.render=function(){var e=this,i=e.config,n=e.elem=a(t(p).render({data:i,index:e.index})),l=i.elem=a(i.elem);l[0]&&(i.data=i.data||[],i.value=i.value||[],e.key=i.id||e.index,l.html(e.elem),e.layBox=e.elem.find("."+s),e.layHeader=e.elem.find("."+u),e.laySearch=e.elem.find("."+h),e.layData=n.find("."+f),e.layBtn=n.find(".layui-transfer-active .layui-btn"),e.layBox.css({width:i.width,height:i.height}),e.layData.css({height:i.height-e.layHeader.outerHeight()-e.laySearch.outerHeight()-2}),e.renderData(),e.events())},v.prototype.renderData=function(){var e=this,a=(e.config,[{checkName:"layTransferLeftCheck",views:[]},{checkName:"layTransferRightCheck",views:[]}]);e.parseData((function(e){var t=e.selected?1:0,i=["<li>",'<input type="checkbox" name="'+a[t].checkName+'" lay-skin="primary" lay-filter="layTransferCheckbox" title="'+e.title+'"'+(e.disabled?" disabled":"")+(e.checked?" checked":"")+' value="'+e.value+'">',"</li>"].join("");a[t].views.push(i),delete e.selected})),e.layData.eq(0).html(a[0].views.join("")),e.layData.eq(1).html(a[1].views.join("")),e.renderCheckBtn()},v.prototype.renderForm=function(e){i.render(e,"LAY-transfer-"+this.index)},v.prototype.renderCheckBtn=function(e){var t=this,i=t.config;e=e||{},t.layBox.each((function(n){var l=a(this),r=l.find("."+f),d=l.find("."+u).find('input[type="checkbox"]'),s=r.find('input[type="checkbox"]'),h=0,y=!1;if(s.each((function(){var e=a(this).data("hide");(this.checked||this.disabled||e)&&h++,this.checked&&!e&&(y=!0)})),d.prop("checked",y&&h===s.length),t.layBtn.eq(n)[y?"removeClass":"addClass"](o),!e.stopNone){var p=r.children("li:not(."+c+")").length;t.noneView(r,p?"":i.text.none)}})),t.renderForm("checkbox")},v.prototype.noneView=function(e,t){var i=a('<p class="layui-none">'+(t||"")+"</p>");e.find("."+d)[0]&&e.find("."+d).remove(),t.replace(/\s/g,"")&&e.append(i)},v.prototype.setValue=function(){var e=this,t=e.config,i=[];return e.layBox.eq(1).find("."+f+' input[type="checkbox"]').each((function(){a(this).data("hide")||i.push(this.value)})),t.value=i,e},v.prototype.parseData=function(e){var t=this.config,i=[];return layui.each(t.data,(function(n,l){l=("function"==typeof t.parseData?t.parseData(l):l)||l,i.push(l=a.extend({},l)),layui.each(t.value,(function(e,a){a==l.value&&(l.selected=!0)})),e&&e(l)})),t.data=i,this},v.prototype.getData=function(e){var a=this.config,t=[];return this.setValue(),layui.each(e||a.value,(function(e,i){layui.each(a.data,(function(e,a){delete a.selected,i==a.value&&t.push(a)}))})),t},v.prototype.events=function(){var e=this,t=e.config;e.elem.on("click",'input[lay-filter="layTransferCheckbox"]+',(function(){var t=a(this).prev(),i=t[0].checked,n=t.parents("."+s).eq(0).find("."+f);t[0].disabled||("all"===t.attr("lay-type")&&n.find('input[type="checkbox"]').each((function(){this.disabled||(this.checked=i)})),e.renderCheckBtn({stopNone:!0}))})),e.layBtn.on("click",(function(){var i=a(this),n=i.data("index"),l=e.layBox.eq(n),r=[];if(!i.hasClass(o)){e.layBox.eq(n).each((function(t){a(this).find("."+f).children("li").each((function(){var t=a(this),i=t.find('input[type="checkbox"]'),n=i.data("hide");i[0].checked&&!n&&(i[0].checked=!1,l.siblings("."+s).find("."+f).append(t.clone()),t.remove(),r.push(i[0].value)),e.setValue()}))})),e.renderCheckBtn();var c=l.siblings("."+s).find("."+h+" input");""===c.val()||c.trigger("keyup"),t.onchange&&t.onchange(e.getData(r),n)}})),e.laySearch.find("input").on("keyup",(function(){var i=this.value,n=a(this).parents("."+h).eq(0).siblings("."+f),l=n.children("li");l.each((function(){var e=a(this),t=e.find('input[type="checkbox"]'),n=-1!==t[0].title.indexOf(i);e[n?"removeClass":"addClass"](c),t.data("hide",!n)})),e.renderCheckBtn();var r=l.length===n.children("li."+c).length;e.noneView(n,r?t.text.searchNone:"")}))},r.that={},r.config={},l.reload=function(e,a){var t=r.that[e];return t.reload(a),r.call(t)},l.getData=function(e){return r.that[e].getData()},l.render=function(e){var a=new v(e);return r.call(a)},e(n,l)}));