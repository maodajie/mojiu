layui.define("form",(function(e){"use strict";var i=layui.$,a=layui.form,n=layui.layer,t="tree",l={config:{},index:layui[t]?layui[t].index+1e4:0,set:function(e){var a=this;return a.config=i.extend({},a.config,e),a},on:function(e,i){return layui.onevent.call(this,t,e,i)}},r=function(){var e=this,i=e.config,a=i.id||e.index;return r.that[a]=e,r.config[a]=i,{config:i,reload:function(i){e.reload.call(e,i)},getChecked:function(){return e.getChecked.call(e)},setChecked:function(i){return e.setChecked.call(e,i)}}},c="layui-hide",d="layui-disabled",s="layui-tree-set",o="layui-tree-iconClick",h="layui-icon-addition",u="layui-icon-subtraction",p="layui-tree-entry",f="layui-tree-main",y="layui-tree-txt",v="layui-tree-pack",C="layui-tree-spread",k="layui-tree-setLineShort",m="layui-tree-showLine",x="layui-tree-lineExtend",b=function(e){var a=this;a.index=++l.index,a.config=i.extend({},a.config,l.config,e),a.render()};b.prototype.config={data:[],showCheckbox:!1,showLine:!0,accordion:!1,onlyIconControl:!1,isJump:!1,edit:!1,text:{defaultNodeName:"未命名",none:"无数据"}},b.prototype.reload=function(e){var a=this;layui.each(e,(function(e,i){i.constructor===Array&&delete a.config[e]})),a.config=i.extend(!0,{},a.config,e),a.render()},b.prototype.render=function(){var e=this,a=e.config;e.checkids=[];var n=i('<div class="layui-tree'+(a.showCheckbox?" layui-form":"")+(a.showLine?" layui-tree-line":"")+'" lay-filter="LAY-tree-'+e.index+'"></div>');e.tree(n);var t=a.elem=i(a.elem);if(t[0]){if(e.key=a.id||e.index,e.elem=n,e.elemNone=i('<div class="layui-tree-emptyText">'+a.text.none+"</div>"),t.html(e.elem),0==e.elem.find(".layui-tree-set").length)return e.elem.append(e.elemNone);a.showCheckbox&&e.renderForm("checkbox"),e.elem.find(".layui-tree-set").each((function(){var e=i(this);e.parent(".layui-tree-pack")[0]||e.addClass("layui-tree-setHide"),!e.next()[0]&&e.parents(".layui-tree-pack").eq(1).hasClass("layui-tree-lineExtend")&&e.addClass(k),e.next()[0]||e.parents(".layui-tree-set").eq(0).next()[0]||e.addClass(k)})),e.events()}},b.prototype.renderForm=function(e){a.render(e,"LAY-tree-"+this.index)},b.prototype.tree=function(e,a){var n=this,t=n.config,l=a||t.data;layui.each(l,(function(a,l){var r=l.children&&l.children.length>0,o=i('<div class="layui-tree-pack" '+(l.spread?'style="display: block;"':"")+"></div>"),h=i(['<div data-id="'+l.id+'" class="layui-tree-set'+(l.spread?" layui-tree-spread":"")+(l.checked?" layui-tree-checkedFirst":"")+'">','<div class="layui-tree-entry">','<div class="layui-tree-main">',t.showLine?r?'<span class="layui-tree-iconClick layui-tree-icon"><i class="layui-icon '+(l.spread?"layui-icon-subtraction":"layui-icon-addition")+'"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-icon layui-icon-file"></i></span>':'<span class="layui-tree-iconClick"><i class="layui-tree-iconArrow '+(r?"":c)+'"></i></span>',t.showCheckbox?'<input type="checkbox" name="'+(l.field||"layuiTreeCheck_"+l.id)+'" same="layuiTreeCheck" lay-skin="primary" '+(l.disabled?"disabled":"")+' value="'+l.id+'">':"",t.isJump&&l.href?'<a href="'+l.href+'" target="_blank" class="'+y+'">'+(l.title||l.label||t.text.defaultNodeName)+"</a>":'<span class="'+y+(l.disabled?" "+d:"")+'">'+(l.title||l.label||t.text.defaultNodeName)+"</span>","</div>",function(){if(!t.edit)return"";var e={add:'<i class="layui-icon layui-icon-add-1"  data-type="add"></i>',update:'<i class="layui-icon layui-icon-edit" data-type="update"></i>',del:'<i class="layui-icon layui-icon-delete" data-type="del"></i>'},i=['<div class="layui-btn-group layui-tree-btnGroup">'];return!0===t.edit&&(t.edit=["update","del"]),"object"==typeof t.edit?(layui.each(t.edit,(function(a,n){i.push(e[n]||"")})),i.join("")+"</div>"):void 0}(),"</div></div>"].join(""));r&&(h.append(o),n.tree(o,l.children)),e.append(h),h.prev("."+s)[0]&&h.prev().children(".layui-tree-pack").addClass("layui-tree-showLine"),r||h.parent(".layui-tree-pack").addClass("layui-tree-lineExtend"),n.spread(h,l),t.showCheckbox&&(l.checked&&n.checkids.push(l.id),n.checkClick(h,l)),t.edit&&n.operate(h,l)}))},b.prototype.spread=function(e,a){var n=this.config,t=e.children("."+p),l=t.children("."+f),r=t.find("."+o),c=t.find("."+y),k=n.onlyIconControl?r:l,m="";k.on("click",(function(i){var a=e.children("."+v),t=k.children(".layui-icon")[0]?k.children(".layui-icon"):k.find(".layui-tree-icon").children(".layui-icon");if(a[0]){if(e.hasClass(C))e.removeClass(C),a.slideUp(200),t.removeClass(u).addClass(h);else if(e.addClass(C),a.slideDown(200),t.addClass(u).removeClass(h),n.accordion){var l=e.siblings("."+s);l.removeClass(C),l.children("."+v).slideUp(200),l.find(".layui-tree-icon").children(".layui-icon").removeClass(u).addClass(h)}}else m="normal"})),c.on("click",(function(){i(this).hasClass(d)||(m=e.hasClass(C)?n.onlyIconControl?"open":"close":n.onlyIconControl?"close":"open",n.click&&n.click({elem:e,state:m,data:a}))}))},b.prototype.setCheckbox=function(e,i,a){var n=(this.config,a.prop("checked"));if(!a.prop("disabled")){if("object"==typeof i.children||e.find("."+v)[0])e.find("."+v).find('input[same="layuiTreeCheck"]').each((function(){this.disabled||(this.checked=n)}));var t=function(e){if(e.parents("."+s)[0]){var i,a=e.parent("."+v),l=a.parent(),r=a.prev().find('input[same="layuiTreeCheck"]');n?r.prop("checked",n):(a.find('input[same="layuiTreeCheck"]').each((function(){this.checked&&(i=!0)})),i||r.prop("checked",!1)),t(l)}};t(e),this.renderForm("checkbox")}},b.prototype.checkClick=function(e,a){var n=this,t=n.config;e.children("."+p).children("."+f).on("click",'input[same="layuiTreeCheck"]+',(function(l){layui.stope(l);var r=i(this).prev(),c=r.prop("checked");r.prop("disabled")||(n.setCheckbox(e,a,r),t.oncheck&&t.oncheck({elem:e,checked:c,data:a}))}))},b.prototype.operate=function(e,a){var t=this,l=t.config,r=e.children("."+p),d=r.children("."+f);r.children(".layui-tree-btnGroup").on("click",".layui-icon",(function(r){layui.stope(r);var f=i(this).data("type"),b=e.children("."+v),g={data:a,type:f,elem:e};if("add"==f){b[0]||(l.showLine?(d.find("."+o).addClass("layui-tree-icon"),d.find("."+o).children(".layui-icon").addClass(h).removeClass("layui-icon-file")):d.find(".layui-tree-iconArrow").removeClass(c),e.append('<div class="layui-tree-pack"></div>'));var w=l.operate&&l.operate(g),N={};if(N.title=l.text.defaultNodeName,N.id=w,t.tree(e.children("."+v),[N]),l.showLine)if(b[0])b.hasClass(x)||b.addClass(x),e.find("."+v).each((function(){i(this).children("."+s).last().addClass(k)})),b.children("."+s).last().prev().hasClass(k)?b.children("."+s).last().prev().removeClass(k):b.children("."+s).last().removeClass(k),!e.parent("."+v)[0]&&e.next()[0]&&b.children("."+s).last().removeClass(k);else{var T=e.siblings("."+s),L=1,A=e.parent("."+v);layui.each(T,(function(e,a){i(a).children("."+v)[0]||(L=0)})),1==L?(T.children("."+v).addClass(m),T.children("."+v).children("."+s).removeClass(k),e.children("."+v).addClass(m),A.removeClass(x),A.children("."+s).last().children("."+v).children("."+s).last().addClass(k)):e.children("."+v).children("."+s).addClass(k)}if(!l.showCheckbox)return;if(d.find('input[same="layuiTreeCheck"]')[0].checked)e.children("."+v).children("."+s).last().find('input[same="layuiTreeCheck"]')[0].checked=!0;t.renderForm("checkbox")}else if("update"==f){var I=d.children("."+y).html();d.children("."+y).html(""),d.append('<input type="text" class="layui-tree-editInput">'),d.children(".layui-tree-editInput").val(I).focus();var F=function(e){var i=e.val().trim();i=i||l.text.defaultNodeName,e.remove(),d.children("."+y).html(i),g.data.title=i,l.operate&&l.operate(g)};d.children(".layui-tree-editInput").blur((function(){F(i(this))})),d.children(".layui-tree-editInput").on("keydown",(function(e){13===e.keyCode&&(e.preventDefault(),F(i(this)))}))}else n.confirm('确认删除该节点 "<span style="color: #999;">'+(a.title||"")+'</span>" 吗？',(function(a){if(l.operate&&l.operate(g),g.status="remove",n.close(a),!e.prev("."+s)[0]&&!e.next("."+s)[0]&&!e.parent("."+v)[0])return e.remove(),void t.elem.append(t.elemNone);if(e.siblings("."+s).children("."+p)[0]){if(l.showCheckbox){var r=function(e){if(e.parents("."+s)[0]){var a=e.siblings("."+s).children("."+p),n=e.parent("."+v).prev(),l=n.find('input[same="layuiTreeCheck"]')[0],c=1,d=0;0==l.checked&&(a.each((function(e,a){var n=i(a).find('input[same="layuiTreeCheck"]')[0];0!=n.checked||n.disabled||(c=0),n.disabled||(d=1)})),1==c&&1==d&&(l.checked=!0,t.renderForm("checkbox"),r(n.parent("."+s))))}};r(e)}if(l.showLine){var d=e.siblings("."+s),h=1,f=e.parent("."+v);layui.each(d,(function(e,a){i(a).children("."+v)[0]||(h=0)})),1==h?(b[0]||(f.removeClass(x),d.children("."+v).addClass(m),d.children("."+v).children("."+s).removeClass(k)),e.next()[0]?f.children("."+s).last().children("."+v).children("."+s).last().addClass(k):e.prev().children("."+v).children("."+s).last().addClass(k),e.next()[0]||e.parents("."+s)[1]||e.parents("."+s).eq(0).next()[0]||e.prev("."+s).addClass(k)):!e.next()[0]&&e.hasClass(k)&&e.prev().addClass(k)}}else{var y=e.parent("."+v).prev();if(l.showLine){y.find("."+o).removeClass("layui-tree-icon"),y.find("."+o).children(".layui-icon").removeClass(u).addClass("layui-icon-file");var w=y.parents("."+v).eq(0);w.addClass(x),w.children("."+s).each((function(){i(this).children("."+v).children("."+s).last().addClass(k)}))}else y.find(".layui-tree-iconArrow").addClass(c);e.parents("."+s).eq(0).removeClass(C),e.parent("."+v).remove()}e.remove()}))}))},b.prototype.events=function(){var e=this,a=e.config;e.elem.find(".layui-tree-checkedFirst"),e.setChecked(e.checkids),e.elem.find(".layui-tree-search").on("keyup",(function(){var n=i(this),t=n.val(),l=n.nextAll(),r=[];l.find("."+y).each((function(){var e=i(this).parents("."+p);if(-1!=i(this).html().indexOf(t)){r.push(i(this).parent());var a=function(e){e.addClass("layui-tree-searchShow"),e.parent("."+v)[0]&&a(e.parent("."+v).parent("."+s))};a(e.parent("."+s))}})),l.find("."+p).each((function(){var e=i(this).parent("."+s);e.hasClass("layui-tree-searchShow")||e.addClass(c)})),0==l.find(".layui-tree-searchShow").length&&e.elem.append(e.elemNone),a.onsearch&&a.onsearch({elem:r})})),e.elem.find(".layui-tree-search").on("keydown",(function(){i(this).nextAll().find("."+p).each((function(){i(this).parent("."+s).removeClass("layui-tree-searchShow "+c)})),i(".layui-tree-emptyText")[0]&&i(".layui-tree-emptyText").remove()}))},b.prototype.getChecked=function(){var e=this.config,a=[],n=[];this.elem.find(".layui-form-checked").each((function(){a.push(i(this).prev()[0].value)}));var t=function(e,n){layui.each(e,(function(e,l){layui.each(a,(function(e,a){if(l.id==a){var r=i.extend({},l);return delete r.children,n.push(r),l.children&&(r.children=[],t(l.children,r.children)),!0}}))}))};return t(i.extend({},e.data),n),n},b.prototype.setChecked=function(e){this.config,this.elem.find("."+s).each((function(a,n){var t=i(this).data("id"),l=i(n).children("."+p).find('input[same="layuiTreeCheck"]'),r=l.next();if("number"==typeof e){if(t==e)return l[0].checked||r.click(),!1}else"object"==typeof e&&layui.each(e,(function(e,i){if(i==t&&!l[0].checked)return r.click(),!0}))}))},r.that={},r.config={},l.reload=function(e,i){var a=r.that[e];return a.reload(i),r.call(a)},l.getChecked=function(e){return r.that[e].getChecked()},l.setChecked=function(e,i){return r.that[e].setChecked(i)},l.render=function(e){var i=new b(e);return r.call(i)},e(t,l)}));